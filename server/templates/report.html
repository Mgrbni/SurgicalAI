<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SurgicalAI — Photo Analysis {{ run_id }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="report.css">
</head>
<body>
<header class="header">
  <div class="brand">
    <div class="logo">SurgicalAI</div>
    <div class="meta">RUN {{ run_id }} · {{ created_at }}</div>
  </div>
  <div class="ribbon">NOT FOR CLINICAL USE — DEMO ONLY</div>
</header>

<main>
  <section>
    <h1>Case Summary</h1>
    <div class="grid-2">
      <div>
        <h2>Probabilities</h2>
        <ul class="bars">
          {% for label, p in metrics.ordered_probabilities if metrics else probs.items() %}
          <li>
            <span class="label">{{ label|replace('_', ' ')|capitalize }}</span>
            <div class="bar"><span style="width: {{ (p*100)|round(1) }}%"></span></div>
            <span class="val">{{ (p*100)|round(1) }}%</span>
          </li>
          {% endfor %}
        </ul>
      </div>
      <div>
        <h2>Oncology Gate</h2>
        <div class="chip {{ gate.status|lower }}">{{ gate.status }}</div>
        <p class="reason">{{ gate.notes or gate.reason }}</p>
        {% if gate.guidance %}<p class="guidance">{{ gate.guidance }}</p>{% endif %}
        
        {% if metrics.reconstruction_text %}
        <div class="reconstruction">
            <h3>Reconstruction Plan</h3>
            <p><strong>Choice:</strong> {{ metrics.reconstruction_choice|replace('_', ' ')|capitalize }}</p>
            <p>{{ metrics.reconstruction_text }}</p>
        </div>
        {% endif %}
      </div>
    </div>
  </section>

  <section>
    <h1>Images</h1>
    <div class="grid-3">
      <figure>
        <img src="{{ original_path }}" alt="Original">
        <figcaption>Original</figcaption>
      </figure>
      <figure>
        <img src="{{ heatmap_path }}" alt="Heatmap">
        <figcaption>Heatmap</figcaption>
      </figure>
      <figure>
        <img src="{{ overlay_path }}" alt="Overlay">
        <figcaption>Overlay</figcaption>
      </figure>
    </div>
  </section>

  {% if metrics.guidelines %}
  <section>
    <h1>Clinical Guidelines</h1>
    <div class="guidelines">
      {% for g in metrics.guidelines %}
      <div class="guideline">
        <h3>{{ g.diagnosis|replace('_', ' ')|capitalize }}</h3>
        <p><strong>Excision Margin:</strong> {{ g.margin }}</p>
        <p>{{ g.summary }}</p>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {% if metrics.risk_factors %}
  <section>
    <h1>Patient & Lesion Factors</h1>
    <div class="grid-2">
        <div>
            <h2>Risk Factors</h2>
            <ul class="kv-list">
              {% for k, v in metrics.risk_factors.items() %}
              <li><strong>{{ k|replace('_', ' ')|capitalize }}:</strong> {{ v }}</li>
              {% endfor %}
            </ul>
        </div>
        {% if metrics.lesion_center or metrics.incision_angle %}
        <div>
            <h2>Lesion Details</h2>
            <ul class="kv-list">
                {% if metrics.lesion_center %}
                <li><strong>Center:</strong> ({{ metrics.lesion_center[0] }}, {{ metrics.lesion_center[1] }}) px</li>
                {% endif %}
                {% if metrics.incision_angle %}
                <li><strong>Incision Angle:</strong> {{ metrics.incision_angle|round(1) }}°</li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
    </div>
  </section>
  {% endif %}
</main>

<footer class="footer">
  Dr. Mehdi Ghorbani Karimabad – Plastic, Reconstructive &amp; Aesthetic Surgery · Generated {{ created_at }}Z
</footer>
</body>
</html>
